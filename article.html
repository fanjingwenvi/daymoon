<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Article - Daymoon">
<title>Article - Daymoon</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">


<!-- Showdown.js for Markdown rendering -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
<!-- Highlight.js for code syntax highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-38S46XKC7V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-38S46XKC7V');
</script>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <a href="index.html" class="logo">Daymoon</a>
        <div class="nav-links">
          <a href="writings.html">Writings</a>
          <a href="projects.html">Projects</a>
          <a href="photography.html">Photography</a>
          <a href="about.html">About</a>
        </div>
      </nav>
    </div>
  </header>

  <section class="section">
    <div class="container">
      <div class="article-container">
        <div class="article-header">
          <h1 id="article-title">Loading article...</h1>
          <p id="article-date" class="article-date"></p>
        </div>
        
        <div class="article-content">
          <div id="markdown-content" class="markdown-content">
            <!-- Article content will be rendered here -->
            <p>Loading content...</p>
          </div>
        </div>
        
        <div class="article-footer">
          <a href="writings.html" class="back-link">‚Üê Back to all writings</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer removed -->

  <script>
    // Function to get URL parameters
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    
    // Function to render markdown to HTML
    function renderMarkdown(markdown) {
      const converter = new showdown.Converter({
        tables: true,
        tasklists: true,
        strikethrough: true,
        ghCodeBlocks: true,
        emoji: true
      });
      return converter.makeHtml(markdown);
    }
    
    // Function to extract title from markdown content
    function extractTitle(markdown) {
      const titleMatch = markdown.match(/^# (.*)$/m);
      return titleMatch ? titleMatch[1] : 'Untitled Article';
    }
    
    // Function to load and display the article
    async function loadArticle() {
      const articleFile = getUrlParameter('article');
      
      if (!articleFile) {
        document.getElementById('article-title').textContent = 'Article Not Found';
        document.getElementById('markdown-content').innerHTML = '<p>The requested article could not be found.</p>';
        return;
      }
      
      try {
        const response = await fetch(`writings/${articleFile}`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const markdown = await response.text();
        const title = extractTitle(markdown);
        
        // Set the page title
        document.title = `${title} - Daymoon`;
        
        // Update the article title
        document.getElementById('article-title').textContent = title;
        
        // Render the markdown content
        document.getElementById('markdown-content').innerHTML = renderMarkdown(markdown);
        
        // Apply syntax highlighting to code blocks
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
        
        // Extract date from filename or use a default
        const dateMatch = articleFile.match(/-(\d{4}-\d{2}-\d{2})\.md$/);
        const dateStr = dateMatch ? dateMatch[1] : '';
        
        if (dateStr) {
          const date = new Date(dateStr);
          document.getElementById('article-date').textContent = date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
        }
      } catch (error) {
        console.error('Error loading article:', error);
        document.getElementById('article-title').textContent = 'Error Loading Article';
        document.getElementById('markdown-content').innerHTML = `<p>There was an error loading the article: ${error.message}</p>`;
      }
    }
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', loadArticle);
  </script>
</body>
</html>